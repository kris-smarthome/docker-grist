

services:
  grist:
    image: gristlabs/grist:1.0.8 # Change! --> https://hub.docker.com/r/gristlabs/grist/tags
    container_name: grist
    user: "1000" # Optional Change
    volumes:
      - grist:/persist
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.grist.rule=Host(`${GRIST_DOMAIN}`)"
      - "traefik.http.routers.grist.entrypoints=websecure"
      - "traefik.http.routers.grist.tls.certresolver=letsencrypt"
      - "traefik.http.services.grist.loadbalancer.server.port=3000"
    #ports:
    #  - 3000:8080
    depends_on:
      - postgres

  postgres:
    image: postgres:15-alpine
    container_name: grist_postgres
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    #user: "1000" # Optional Change
    environment:
      - POSTGRES_USER
      - POSTGRES_PASSWORD
      - POSTGRES_DB
    volumes:
      - postgres:/var/lib/postgresql/data

networks:
  traefik:
    external: true
  grist:
    driver: bridge

volumes:
  grist:
    driver: local 
  postgres:
    driver: local